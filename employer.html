
<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Employer — GrowIndia</title>
  <link rel="stylesheet" href="/app.css"/>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="/config.js?v=1"></script>
  <script src="/components.js?v=1"></script>
</head>
<body>
  <div class="container">
    <div class="row" style="align-items:center">
      <h1 class="h1" style="flex:unset">Employer</h1>
      <a class="btn" href="/jobs.html">Public site</a>
      <button class="btn" id="logoutTop">Logout</button>
    </div>

    <div class="card">
      <h2 class="h2">Your company</h2>
      <div class="grid">
        <select id="companySel" class="input"></select>
        <input id="newCompany" class="input" placeholder="New company name"/>
        <input id="website" class="input" placeholder="Website (https://…)"/>
        <button id="createCompany" class="btn">Create company</button>
      </div>
    </div>

    <div class="card">
      <h2 class="h2">Post a job</h2>
      <div class="grid">
        <input id="title" class="input" placeholder="Job title"/>
        <input id="location" class="input" placeholder="Location"/>
        <select id="type" class="input">
          <option value="Full-time">Full-time</option>
          <option value="Part-time">Part-time</option>
          <option value="Contract">Contract</option>
          <option value="Internship">Internship</option>
        </select>
        <div class="row">
          <input id="minSalary" class="input" placeholder="Min salary"/>
          <input id="maxSalary" class="input" placeholder="Max salary"/>
          <input id="currency" class="input" placeholder="Currency (e.g., USD, INR)"/>
        </div>
        <textarea id="description" placeholder="Description"></textarea>
        <label><input type="checkbox" id="published" checked/> Published</label>
        <button id="postJob" class="btn primary">Post job</button>
        <div id="postMsg" class="muted"></div>
      </div>
    </div>

    <div class="card">
      <h2 class="h2">Your jobs</h2>
      <table class="table">
        <thead><tr><th>Title</th><th>Status</th><th>Created</th></tr></thead>
        <tbody id="jobsBody"></tbody>
      </table>
    </div>

  </div>

<script>
(async()=>{
  const s = await requireAuth();
  header(s?.user, await isAdmin());
  document.getElementById("logoutTop").onclick = async()=>{ await sbAuth.signOut(); location.href="/index.html"; };

  const sel = document.getElementById("companySel");
  const jobsBody = document.getElementById("jobsBody");
  jobsBody.innerHTML = spinnerRow();

  async function loadCompanies(){
    sel.innerHTML = "";
    const { data, error } = await sb.from("companies").select("id,name").eq("owner_id", s.user.id).order("created_at", {ascending:false});
    if(error){ sel.innerHTML = `<option>Error loading companies</option>`; return; }
    if(!data.length){ sel.innerHTML = `<option value="">(none)</option>`; }
    else{
      sel.innerHTML = data.map(c=>`<option value="${c.id}">${c.name}</option>`).join("");
    }
  }

  async function loadJobs(){
    jobsBody.innerHTML = spinnerRow();
    const { data, error } = await sb.from("jobs").select("id,title,status,created_at").eq("created_by", s.user.id).order("created_at", {ascending:false});
    if(error){ jobsBody.innerHTML = `<tr><td colspan="99">Error: ${error.message}</td></tr>`; return; }
    if(!data.length){ jobsBody.innerHTML = `<tr><td colspan="99" class="muted">No jobs yet.</td></tr>`; return; }
    jobsBody.innerHTML = data.map(j=>`<tr>
      <td><a href="/job.html?id=${encodeURIComponent(j.id)}">${j.title}</a></td>
      <td>${j.status || 'open'}</td>
      <td>${new Date(j.created_at).toLocaleString()}</td>
    </tr>`).join("");
  }

  // create company
  document.getElementById("createCompany").onclick = async ()=>{
    const name = document.getElementById("newCompany").value.trim();
    const website = document.getElementById("website").value.trim();
    if(!name) return alert("Enter a company name");
    const { error } = await sb.from("companies").insert({ name, website, owner_id: s.user.id });
    if(error) return alert(error.message);
    document.getElementById("newCompany").value="";
    document.getElementById("website").value="";
    await loadCompanies();
  };

  // post job
  document.getElementById("postJob").onclick = async ()=>{
    const postMsg = document.getElementById("postMsg");
    postMsg.textContent = "";
    const payload = {
      title: document.getElementById("title").value.trim(),
      location: document.getElementById("location").value.trim(),
      type: document.getElementById("type").value,
      min_salary: document.getElementById("minSalary").value.trim(),
      max_salary: document.getElementById("maxSalary").value.trim(),
      currency: document.getElementById("currency").value.trim(),
      description: document.getElementById("description").value.trim(),
      published: document.getElementById("published").checked,
      company_id: sel.value || null,
      created_by: s.user.id
    };
    if(!payload.title) return postMsg.textContent="Title required";
    if(!payload.company_id) return postMsg.textContent="Select a company (create one first)";
    const { error } = await sb.from("jobs").insert(payload);
    postMsg.textContent = error ? ("Error: "+error.message) : "Job posted!";
    if(!error){ await loadJobs(); }
  };

  await loadCompanies();
  await loadJobs();
})();
<!-- Supabase + app scripts (order matters) -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="/config.js?v=5"></script>
<script src="/components.js?v=5"></script>
</body>
</html>
