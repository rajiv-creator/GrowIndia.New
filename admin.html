
<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Admin â€” GrowIndia</title>
  <link rel="stylesheet" href="/app.css"/>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="/config.js?v=1"></script>
  <script src="/components.js?v=1"></script>
</head>
<body>
  <div class="container">
    <div id="banner" class="card warn hidden">You are not an admin.</div>

    <div class="card">
      <h2 class="h2">Companies</h2>
      <table class="table"><thead><tr><th>Name</th><th>Owner</th><th>Website</th><th>Created</th></tr></thead>
      <tbody id="companiesBody"></tbody></table>
    </div>

    <div class="card">
      <h2 class="h2">Jobs</h2>
      <table class="table"><thead><tr><th>Title</th><th>Company</th><th>Published</th><th>Created</th></tr></thead>
      <tbody id="jobsBody"></tbody></table>
    </div>
  </div>

<script>
(async()=>{
  const s = await requireAuth();
  const admin = await isAdmin();
  header(s?.user, admin);
  if(!admin){ document.getElementById("banner").classList.remove("hidden"); return; }

  const cbody = document.getElementById("companiesBody");
  const jbody = document.getElementById("jobsBody");
  cbody.innerHTML = spinnerRow(); jbody.innerHTML = spinnerRow();

  const { data: companies, error: cerr } = await sb.from("companies")
    .select("name, website, created_at, owner_id").order("created_at", {ascending:false});
  cbody.innerHTML = cerr ? `<tr><td colspan="99">Error: ${cerr.message}</td></tr>` :
    companies.map(c=>`<tr><td>${c.name}</td><td class="small">${c.owner_id}</td><td>${c.website||""}</td><td>${fmtDate(c.created_at)}</td></tr>`).join("");

  const { data: jobs, error: jerr } = await sb.from("jobs")
    .select("title, published, created_at, companies(name)").order("created_at",{ascending:false});
  jbody.innerHTML = jerr ? `<tr><td colspan="99">Error: ${jerr.message}</td></tr>` :
    jobs.map(j=>`<tr><td>${j.title}</td><td>${j.companies?.name||""}</td><td>${j.published?'yes':'no'}</td><td>${fmtDate(j.created_at)}</td></tr>`).join("");
})();
</script>
</body>
</html>
