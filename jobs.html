<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Jobs • GrowIndia Jobs</title>
  <style>
    :root{
      --blue:#151B54; --blue-600:#101542; --orange:#FF6E00;
      --ink:rgba(15,23,42,.92); --bg:#F6F8FC; --card:#fff; --line:#E5E7EB; --muted:#64748B;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--ink);font:400 16px/1.5 Inter, "Noto Sans", system-ui, -apple-system, "Segoe UI", Roboto, Helvetica, Arial, sans-serif}

    .wrap{max-width:1200px;margin:0 auto;padding:24px 20px}
    h1{font:800 42px/1.2 Inter;margin:18px 0 12px}
    .grid{display:grid;grid-template-columns:300px 1fr;gap:24px}
    @media (max-width:960px){ .grid{grid-template-columns:1fr} }

    /* Search bar */
    .searchbar{background:#fff;border:1px solid rgba(0,0,0,.06);border-radius:16px;box-shadow:0 6px 18px rgba(2,6,23,.08), inset 0 1px 0 rgba(255,255,255,.6);padding:10px;display:flex;gap:10px;align-items:center}
    .searchbar input[type="text"]{flex:1;border:0;outline:none;font:500 15px Inter;color:var(--ink);background:transparent;padding:12px 14px;border-radius:12px}
    .btn{display:inline-flex;align-items:center;justify-content:center;border:0;border-radius:12px;padding:12px 18px;font:700 14px Inter;color:#fff;background:var(--blue);cursor:pointer}
    .btn:hover{background:var(--blue-600)}
    .btn:focus-visible{outline:2px solid var(--blue-600)}
    .sort{margin-left:12px;color:var(--muted);font-weight:600}

    /* Filters */
    .card{background:var(--card);border:1px solid var(--line);border-radius:16px;box-shadow:0 6px 18px rgba(2,6,23,.04)}
    .filters{padding:18px}
    .filters h3{margin:6px 0 12px;font:700 16px Inter}
    .field{margin:14px 0}
    .field label{display:block;font:600 13px Inter;color:var(--muted);margin-bottom:8px}
    select, input[type="search"], input[type="text"]{width:100%;padding:12px 14px;border:1px solid var(--line);border-radius:12px;background:#fff;font:500 14px Inter;outline:none}
    select:focus, input:focus{border-color:var(--blue)}

    /* Results */
    .results{display:grid;gap:12px;margin-top:16px}
    .job{background:var(--card);border:1px solid var(--line);border-radius:16px;padding:16px 18px;display:flex;align-items:center;justify-content:space-between}
    .meta{display:flex;gap:8px;color:var(--muted);font-weight:600}
    .view{border-radius:10px;padding:10px 14px;background:var(--blue);color:#fff;font:700 13px Inter;text-decoration:none}
    .view:hover{background:var(--blue-600)}
    .empty{background:#fff;border:1px dashed var(--line);border-radius:16px;padding:24px;color:var(--muted);text-align:center}
    .topbar{display:flex;gap:12px;align-items:center;margin:10px 0 0}

    /* Pager */
    .pager{display:flex;gap:8px;align-items:center;margin:16px 0 8px}
    .pagebtn{padding:8px 12px;border-radius:10px;border:1px solid var(--line);background:#fff;cursor:pointer;font:600 13px Inter}
    .pagebtn[disabled]{opacity:.5;cursor:not-allowed}
  </style>
</head>
<body>

  <!-- header comes from components.js -->
  <div class="wrap">
    <h1>Jobs</h1>
    <div class="topbar">
      <div class="searchbar" style="flex:1">
        <input id="q" type="text" placeholder="Job title, keywords, or company" />
        <button id="searchBtn" class="btn">Search</button>
      </div>
      <div class="sort">Sort: <strong>Newest</strong></div>
    </div>

    <div class="grid">
      <!-- Filters -->
      <aside class="card filters">
        <div class="field">
          <label>Department (placeholder)</label>
          <select id="dept">
            <option value="all">All</option>
          </select>
        </div>

        <div class="field">
          <label>Employment Type</label>
          <select id="type">
            <option value="all">All</option>
            <option>full-time</option>
            <option>part-time</option>
            <option>contract</option>
            <option>internship</option>
          </select>
        </div>

        <div class="field">
          <label>Location</label>
          <input id="loc" type="search" placeholder="e.g., Dehradun" />
        </div>

        <div class="field">
          <button id="applyFilters" class="btn" style="width:100%">Apply filters</button>
        </div>
      </aside>

      <!-- Results -->
      <main>
        <div id="results" class="results">
          <div class="empty">Loading…</div>
        </div>
        <div class="pager">
          <button id="prev" class="pagebtn">Prev</button>
          <span id="pageInfo" style="font:600 13px Inter;color:var(--muted)">Page 1</span>
          <button id="next" class="pagebtn">Next</button>
        </div>
      </main>
    </div>
  </div>

  <!-- Order: config → supabase client; then components; then page script -->
  <script src="/config.js"></script>
  <script src="/components.js?v=18"></script>
  <script>
    // Hide Candidate/Employer pills on this page
    app.header({ showRoleCTAs: false });

    // ---- state from URL params
    const params = new URLSearchParams(location.search);
    const state = {
      q: params.get('q') || '',
      loc: params.get('loc') || '',
      type: params.get('type') || 'all',
      page: Math.max(1, parseInt(params.get('page') || '1', 10)),
      pageSize: 12
    };

    // hook up inputs
    const $q = ui.qs('#q'); const $loc = ui.qs('#loc'); const $type = ui.qs('#type');
    $q.value = state.q; $loc.value = state.loc; $type.value = state.type;

    async function runSearch() {
      try {
        ui.qs('#results').innerHTML = `<div class="empty">Loading…</div>`;
        const { items, total, totalPages } = await db.searchJobs(state);

        // render
        if (!items.length) {
          ui.qs('#results').innerHTML = `<div class="empty">No jobs match your filters.</div>`;
        } else {
          ui.qs('#results').innerHTML = items.map(j => {
            const title = j.title || '(No title)';
            const company = j.company || j.company_name || '';
            const place = j.location || [j.city, j.state].filter(Boolean).join(', ');
            const et = j.employment_type || j.type || '';
            const sal = (j.salary_min || j.salary_max) ? `₹${(j.salary_min||'').toLocaleString?.()||j.salary_min||''} – ₹${(j.salary_max||'').toLocaleString?.()||j.salary_max||''}` : '';

            return `
              <article class="job">
                <div>
                  <div style="font:700 18px Inter;margin-bottom:4px">${title}</div>
                  <div class="meta">
                    ${company ? `<span>${company}</span>·` : ``}
                    ${place ? `<span>${place}</span>·` : ``}
                    ${et ? `<span>${et}</span>` : ``}
                    ${sal ? `<span>· ${sal}</span>` : ``}
                  </div>
                </div>
                <a class="view" href="/job.html?id=${encodeURIComponent(j.id)}">View</a>
              </article>
            `;
          }).join('');
        }

        // pager
        ui.qs('#pageInfo').textContent = `Page ${state.page} of ${totalPages}`;
        ui.qs('#prev').disabled = (state.page <= 1);
        ui.qs('#next').disabled = (state.page >= totalPages);

      } catch (err) {
        console.error('search error:', err);
        ui.qs('#results').innerHTML = `<div class="empty">Couldn't load jobs right now.</div>`;
        ui.toast(`Jobs error: ${err.message}`, 'error');
      }
    }

    function pushURL() {
      const p = new URLSearchParams();
      if (state.q) p.set('q', state.q);
      if (state.loc) p.set('loc', state.loc);
      if (state.type) p.set('type', state.type);
      if (state.page > 1) p.set('page', String(state.page));
      history.replaceState({}, '', `/jobs.html?${p.toString()}`);
    }

    // events
    ui.qs('#searchBtn').addEventListener('click', () => {
      state.q = $q.value.trim(); state.page = 1; pushURL(); runSearch();
    });
    ui.qs('#applyFilters').addEventListener('click', () => {
      state.loc = $loc.value.trim();
      state.type = $type.value || 'all';
      state.page = 1;
      pushURL(); runSearch();
    });
    ui.qs('#prev').addEventListener('click', () => { state.page = Math.max(1, state.page-1); pushURL(); runSearch(); });
    ui.qs('#next').addEventListener('click', () => { state.page = state.page+1; pushURL(); runSearch(); });

    // initial
    runSearch();
  </script>
</body>
</html>
