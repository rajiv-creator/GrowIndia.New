<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Jobs</title>
  <style>
    :root{--blue:#151B54;--blue-600:#0F143E;--orange:#FF6E00;--bg:#F6F8FC;--card:#fff;--line:#E5E7EB;--muted:#64748B;--ink:rgba(15,23,42,.9)}
    body{margin:0;background:var(--bg);font-family:Inter,"Noto Sans",system-ui,-apple-system,"Segoe UI",Roboto,Helvetica,Arial,sans-serif}
    .container{max-width:1200px;margin:0 auto;padding:24px 16px}
    header{background:#fff;border-bottom:1px solid var(--line)}
    .nav{max-width:1200px;margin:0 auto;padding:0 16px;display:flex;align-items:center;justify-content:space-between;height:68px}
    .brand{font-weight:800}
    .nav-right{display:flex;gap:14px;align-items:center}
    .nav-right a.link{color:#111827}
    .btn{display:inline-block;padding:9px 14px;border-radius:999px;font-weight:700;color:#fff}
    .btn-blue{background:var(--blue)} .btn-blue:hover{background:var(--blue-600)}
    .btn-orange{background:var(--orange)} .btn-orange:hover{filter:brightness(.95)}

    .layout{display:grid;grid-template-columns:280px 1fr;gap:16px}
    .panel{background:#fff;border:1px solid var(--line);border-radius:16px;box-shadow:0 6px 18px rgba(2,6,23,.06);padding:16px}
    .label{font-weight:700;margin:8px 0 6px;display:block}
    input,select{width:100%;padding:10px;border:1px solid var(--line);border-radius:10px}
    input:focus,select:focus{border-color:var(--blue);box-shadow:0 0 0 3px rgba(21,27,84,.15)}

    .jobs{display:grid;grid-template-columns:repeat(2,1fr);gap:16px}
    .job{background:#fff;border:1px solid var(--line);border-radius:16px;padding:16px}
    .job h3{margin:0 0 4px}
    .meta{color:var(--muted);font-size:14px}
    .btn-small{display:inline-block;margin-top:6px;background:var(--blue);color:#fff;padding:8px 12px;border-radius:10px}
    .toolbar{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}
    .pagination{display:flex;gap:8px;align-items:center;justify-content:flex-end;margin-top:16px}
    .pagination button{border:1px solid var(--line);background:#fff;border-radius:10px;padding:8px 12px;cursor:pointer}
    .pagination button[disabled]{opacity:.5;cursor:not-allowed}
    @media (max-width: 1000px){.layout{grid-template-columns:1fr}.jobs{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <header>
    <div class="nav">
      <div class="brand">GrowIndia Jobs</div>
      <div class="nav-right">
        <a class="link" href="/jobs.html">Jobs</a>
        <a class="link" href="/post-job.html">Post a Job</a>
        <a class="link" href="/login.html">Sign in</a>
        <a class="btn btn-blue" href="/register-candidate.html">Candidate</a>
        <a class="btn btn-orange" href="/login.html?role=employer">Employer</a>
      </div>
    </div>
  </header>

  <div class="container">
    <h1 style="margin:0 0 12px">Jobs</h1>
    <div class="layout">
      <aside class="panel">
        <label class="label">Department (placeholder)</label>
        <select id="dept">
          <option value="">All</option>
        </select>
        <label class="label">Employment Type</label>
        <select id="type">
          <option value="all">All</option>
          <option>full-time</option>
          <option>part-time</option>
          <option>contract</option>
          <option>internship</option>
        </select>
        <label class="label">Location</label>
        <input id="loc" placeholder="e.g., Dehradun" />
      </aside>
      <main>
        <div class="panel toolbar">
          <form id="searchbar" style="display:flex;gap:8px;flex:1">
            <input id="q" placeholder="Job title, keywords, or company" style="flex:1" />
            <button class="btn btn-blue" type="submit" style="border:0">Search</button>
          </form>
          <div class="muted">Sort: Newest</div>
        </div>
        <section id="grid" class="jobs"></section>
        <div class="pagination" id="pager"></div>
      </main>
    </div>
  </div>

  <script src="/config.js"></script>
  <script src="/components.js?v=16"></script>
  <script>
  (function(){
    const params = new URLSearchParams(location.search);
    const state = {
      q: decodeURIComponent(params.get('q')||'').trim(),
      loc: decodeURIComponent(params.get('loc')||'').trim(),
      type: (params.get('type')||'all'),
      page: parseInt(params.get('page')||'1',10)||1,
      pageSize: 12
    };

    const qInput = document.getElementById('q'); qInput.value = state.q;
    const locInput = document.getElementById('loc'); locInput.value = state.loc;
    const typeSel = document.getElementById('type'); typeSel.value = state.type;

    document.getElementById('searchbar').addEventListener('submit', (e)=>{ e.preventDefault(); state.q = qInput.value.trim(); state.page=1; syncUrlAndLoad(); });
    typeSel.addEventListener('change', ()=>{ state.type = typeSel.value; state.page=1; syncUrlAndLoad(); });
    locInput.addEventListener('change', ()=>{ state.loc = locInput.value.trim(); state.page=1; syncUrlAndLoad(); });

    async function load(){
      const grid = document.getElementById('grid');
      grid.innerHTML = '<div class="panel">Loading…</div>';
      try{
        const { data, count, error } = await db.searchJobs(state);
        if(error) throw error;
        if(!data.length){ grid.innerHTML = '<div class="panel">No jobs found.</div>'; renderPager(0); return; }
        grid.innerHTML = data.map(j=> jobCard(j)).join('');
        renderPager(count||0);
      }catch(err){ grid.innerHTML = '<div class="panel">Failed to load jobs.</div>'; ui.toast(err.message,'error'); }
    }

    function jobCard(j){
      const salary = (j.salary_min||j.salary_max) ? `₹${j.salary_min||''}${j.salary_min&&j.salary_max?'–':''}${j.salary_max||''}` : '—';
      return `<article class="job">
        <h3>${escapeHtml(j.title)}</h3>
        <div class="meta">${escapeHtml(j.company||'')} · ${escapeHtml(j.location||'')} · ${escapeHtml(j.employment_type||'')}</div>
        <div class="meta">Salary: ${salary}</div>
        <a class="btn-small" href="/job.html?id=${encodeURIComponent(j.id)}">View</a>
      </article>`
    }

    function renderPager(total){
      const pager = document.getElementById('pager');
      const pages = Math.max(1, Math.ceil(total / state.pageSize));
      pager.innerHTML = '';
      const prev = document.createElement('button'); prev.textContent = 'Prev'; prev.disabled = state.page<=1; prev.onclick=()=>{ state.page--; syncUrlAndLoad(); };
      const next = document.createElement('button'); next.textContent = 'Next'; next.disabled = state.page>=pages; next.onclick=()=>{ state.page++; syncUrlAndLoad(); };
      const info = document.createElement('span'); info.textContent = `Page ${state.page} of ${pages}`;
      pager.append(prev, info, next);
    }

    function syncUrlAndLoad(){
      const u = new URL(location.href);
      u.searchParams.set('q', state.q);
      u.searchParams.set('loc', state.loc);
      u.searchParams.set('type', state.type);
      u.searchParams.set('page', String(state.page));
      history.replaceState(null,'',u);
      load();
    }
    function escapeHtml(s=''){return s.replace(/[&<>"]+/g, c=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;"}[c]))}

    syncUrlAndLoad();
  })();
  </script>
</body>
</html>
