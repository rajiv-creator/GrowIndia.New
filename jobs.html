<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Jobs · GrowIndia</title>
  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet"/>
  <style>
    :root{--blue:#151B54}
    *{box-sizing:border-box} body{font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;margin:0;background:#fafbff;color:#0f172a}
    main{max-width:1200px;margin:0 auto;padding:24px 20px}
    .page-title{font-size:44px;font-weight:800;margin:16px 0 10px}
    /* Basic card look for job items, keep if you need it */
    .job-cards{display:grid;grid-template-columns:repeat(3,1fr);gap:16px}
    .job{background:#fff;border:1px solid #eef0f3;border-radius:14px;padding:14px}
    .btn{display:inline-block;background:var(--blue);color:#fff;text-decoration:none;padding:10px 14px;border-radius:999px;font-weight:600}
    @media(max-width:1024px){.job-cards{grid-template-columns:1fr}}
  </style>
</head>

<!-- Hides header CTAs on this page -->
<body data-hide-ctas="1">

  <!-- Header is rendered by components.js -->
  <header id="site-header"></header>

  <main id="content">
    <h1 class="page-title">Jobs</h1>

    <!-- YOUR search + filters + listing.
         If you already have a working block, keep it.
         Here’s a minimal placeholder structure (safe to replace with your current one): -->
    <section id="jobs-shell">
      <div style="display:flex;align-items:center;gap:12px;flex-wrap:wrap;margin:12px 0 20px">
        <input id="q" placeholder="Job title, keywords, or company"
               style="flex:1;min-width:260px;padding:12px 14px;border-radius:10px;border:1px solid #e3e7ef;background:#fff"/>
        <button class="btn" id="searchBtn">Search</button>
        <div>Sort: <strong>Newest</strong></div>
      </div>

      <div id="jobs-status" style="padding:16px 0;color:#475569">Loading…</div>

      <div class="job-cards" id="jobCards" hidden></div>
    </section>
  </main>

  <!-- Supabase config FIRST -->
  <script src="/config.js"></script>
  <!-- Shared components (header + sidebar) -->
  <script src="/components.js"></script>

  <!-- Very small job loader (keeps your page working if no other loader is present).
       If you already fetch jobs elsewhere, you can delete this block. -->
  <script>
    (async function(){
      // Try using Supabase if available; otherwise show static cards.
      async function fetchJobs(){
        try{
          if(!window.supabase) throw new Error('no supabase');
          const { data, error } = await supabase
            .from('jobs')
            .select('id,title,company,loc:location,job_type,published,created_at')
            .eq('published', true)
            .order('created_at', { ascending:false })
            .limit(12);
          if(error) throw error;
          return data || [];
        }catch(e){
          console.warn('jobs fallback:', e.message);
          // Fallback demo entries
          return [
            { id:1, title:'final2', company:'Company', loc:'Delhi', job_type:'full-time' },
            { id:2, title:'final.1', company:'Company', loc:'Meerut', job_type:'full-time' },
            { id:3, title:'Testrr', company:'Company', loc:'Dlrehi', job_type:'full-time' },
            { id:4, title:'Test job', company:'Company', loc:'Delhi', job_type:'full-time' },
          ];
        }
      }

      function render(list){
        const status = document.getElementById('jobs-status');
        const wrap = document.getElementById('jobCards');
        wrap.innerHTML = '';
        if(!list.length){
          status.textContent = 'No jobs found.';
          wrap.hidden = true;
          return;
        }
        status.textContent = `${list.length} results`;
        wrap.hidden = false;

        for(const j of list){
          const el = document.createElement('div');
          el.className = 'job';
          el.innerHTML = `
            <div style="font-weight:700;margin-bottom:6px">${j.title || 'Role'}</div>
            <div style="color:#475569;margin-bottom:10px">${j.company || 'Company'} · ${j.loc || j.location || '-'} · ${j.job_type || ''}</div>
            <a class="btn" href="/job.html?id=${encodeURIComponent(j.id)}">View</a>
          `;
          wrap.appendChild(el);
        }
      }

      const list = await fetchJobs();
      render(list);

      document.getElementById('searchBtn')?.addEventListener('click', ()=>{
        const q = document.getElementById('q').value.trim().toLowerCase();
        const filtered = list.filter(j =>
          [j.title, j.company, j.loc, j.location, j.job_type].join(' ').toLowerCase().includes(q)
        );
        render(filtered);
      });
    })();
  </script>
</body>
</html>
