<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Create your profile — GrowIndia</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="/config.js?v=13"></script>
  <script src="/components.js?v=13"></script>
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;margin:0;background:#f8fafc;color:#0f172a}
    .wrap{max-width:760px;margin:0 auto;padding:28px 16px}
    .card{background:#fff;border:1px solid #e5e7eb;border-radius:16px;padding:20px;box-shadow:0 10px 28px rgba(2,6,23,.06)}
    label{display:block;margin:10px 0 6px;font-weight:600}
    input,select{width:100%;padding:12px;border:1px solid #cbd5e1;border-radius:10px}
    button{margin-top:14px;padding:12px 16px;border:none;border-radius:10px;background:#0ea5e9;color:#fff;font-weight:700;cursor:pointer}
    .muted{color:#64748b}
  </style>
</head>
<body>
  <main class="wrap">
    <div class="card">
      <h1 style="margin:0 0 6px">Create your profile</h1>
      <p class="muted" id="who"></p>

      <form id="regForm">
        <label for="role">I am a</label>
        <select id="role" required>
          <option value="">Select…</option>
          <option value="candidate">Candidate</option>
          <option value="employer">Employer / Recruiter</option>
        </select>

        <label for="name">Full name</label>
        <input id="name" required placeholder="Your name">

        <label for="phone">Phone (optional)</label>
        <input id="phone" placeholder="+91…">

        <button id="btnSave" type="submit">Save & continue</button>
      </form>
    </div>
  </main>

  <script>
  (async function(){
    const { requireAuth, db, ui } = window.app;
    let user; try { user = await requireAuth(); } catch { window.location.replace('/login.html'); return; }
    document.getElementById('who').textContent = `Signed in as ${user.email}`;

    // If profile already exists, route now
    try {
      const prof = await db.getProfile(user.id);
      if (prof?.role === 'candidate') return window.location.replace('/dashboard.html');
      if (prof?.role === 'employer')  return window.location.replace('/employer-home.html');
    } catch {}

    document.getElementById('regForm').addEventListener('submit', async (e)=>{
      e.preventDefault();
      const role = document.getElementById('role').value;
      const full_name = document.getElementById('name').value.trim();
      const phone = document.getElementById('phone').value.trim();
      if (!role) return ui.error('Please choose a role');
      if (!full_name) return ui.error('Name is required');
      try {
        await db.saveProfile({ user_id: user.id, role, full_name, phone });
        ui.success('Profile saved');
        if (role==='employer') window.location.replace('/employer-home.html');
        else window.location.replace('/dashboard.html');
      } catch(err){ console.error(err); ui.error('Could not save profile'); }
    });
  })();
  </script>
</body>
</html>
