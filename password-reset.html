<!doctype html>
<html lang="en">
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Set a new password — GrowIndia Jobs</title>
<style>
  :root{--blue:#151B54;--blue-600:#0F143E;--bg:#F6F8FC;--line:#E5E7EB;--muted:#64748B}
  body{margin:0;background:var(--bg);font-family:Inter,"Noto Sans",system-ui,-apple-system,"Segoe UI",Roboto,Helvetica,Arial,sans-serif}
  .wrap{max-width:560px;margin:12vh auto;background:#fff;border:1px solid var(--line);border-radius:16px;
        box-shadow:0 6px 18px rgba(2,6,23,.06);padding:24px}
  h1{margin:0 0 8px;color:#151B54}
  label{display:block;margin:10px 0 6px;font-weight:700}
  input{width:100%;padding:12px;border:1px solid var(--line);border-radius:10px}
  button{background:var(--blue);color:#fff;border:0;border-radius:12px;padding:12px 18px;font-weight:800;cursor:pointer;margin-top:12px}
  button:hover{background:#0F143E}
  .muted{color:#64748B}
</style>
<div class="wrap">
  <h1>Set a new password</h1>
  <div class="muted" id="status">Checking your link…</div>
  <div id="form" style="display:none">
    <label>New password</label>
    <input id="p1" type="password" placeholder="Minimum 6 characters"/>
    <label>Confirm password</label>
    <input id="p2" type="password" placeholder="Re-enter password"/>
    <button id="save">Save password</button>
  </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.45.4/dist/umd/supabase.min.js"></script>
<script src="/config.js"></script>
<script>
(async function(){
  const status = document.getElementById('status');
  try{
    // Let Supabase parse the recovery hash and create a session
    await new Promise(r=>setTimeout(r, 600));
    const { data } = await supabase.auth.getSession();
    if(!data.session){ status.textContent = 'Recovery link invalid or expired.'; return; }

    status.textContent = 'Enter your new password below.'; 
    document.getElementById('form').style.display='block';

    document.getElementById('save').onclick = async ()=>{
      const p1 = document.getElementById('p1').value.trim();
      const p2 = document.getElementById('p2').value.trim();
      if(p1.length < 6){ alert('Password too short'); return; }
      if(p1 !== p2){ alert('Passwords do not match'); return; }
      const { error } = await supabase.auth.updateUser({ password: p1 });
      if(error){ alert(error.message); return; }
      status.textContent = 'Password updated. Redirecting…';
      location.replace('/login.html?reset=1');
    };
  }catch(e){
    status.textContent = e.message || 'Something went wrong.';
  }
})();
</script>
