<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>GrowIndia Jobs</title>
  <style>
    :root{--blue:#151B54;--blue-600:#0F143E;--orange:#FF6E00;--ink:rgba(15,23,42,.9);--bg:#F6F8FC;--card:#fff;--line:#E5E7EB;--muted:#64748B}
    html,body{margin:0;background:var(--bg);color:#0f172a;font-family:Inter,"Noto Sans",system-ui,-apple-system,"Segoe UI",Roboto,Helvetica,Arial,sans-serif}
    a{color:var(--blue);text-decoration:none} a:hover{text-decoration:underline}
    .container{max-width:1200px;margin:0 auto;padding:0 16px}
    header{background:#fff;border-bottom:1px solid var(--line)}
    .nav{display:flex;align-items:center;justify-content:space-between;height:72px}
    .brand{font-weight:800}
    .nav-right{display:flex;gap:12px;align-items:center}
    .btn-pill{display:inline-block;padding:10px 16px;border-radius:999px;font-weight:800;color:#fff;box-shadow:0 6px 16px rgba(2,6,23,.12)}
    .btn-blue{background:var(--blue)} .btn-blue:hover{background:var(--blue-600)}
    .btn-orange{background:var(--orange)} .btn-orange:hover{filter:brightness(.95)}
    .hero{padding:48px 0 24px}
    .hero h1{font-size:36px;margin:0 0 12px;color:var(--ink)}
    .muted{color:var(--muted)}
    .search-wrap{max-width:960px;margin:24px auto 0;background:#fff;border:1px solid rgba(0,0,0,.06);border-radius:16px;
      box-shadow:0 6px 18px rgba(2,6,23,.08), inset 0 1px 0 rgba(255,255,255,.6);display:flex;align-items:stretch;overflow:hidden}
    .search-field{flex:1;display:flex;align-items:center;padding:4px 12px}
    .search-field input{width:100%;border:0;outline:0;padding:16px 12px;font-size:16px;background:transparent;color:#111827}
    .divider{width:1px;background:var(--line);margin:8px 0}
    .search-btn{border:0;background:var(--blue);color:#fff;padding:0 22px;font-weight:800;font-size:16px;cursor:pointer}
    .search-btn:hover{background:var(--blue-600)}
    .values{display:grid;grid-template-columns:repeat(3,1fr);gap:16px;margin:32px 0}
    .card{background:var(--card);border:1px solid var(--line);border-radius:16px;padding:20px;box-shadow:0 4px 14px rgba(2,6,23,.06)}
    .jobs{display:grid;grid-template-columns:repeat(3,1fr);gap:16px}
    .job{background:#fff;border:1px solid var(--line);border-radius:16px;padding:16px}
    .job h4{margin:0 0 4px}.meta{color:var(--muted);font-size:14px}
    .btn-view{display:inline-block;margin-top:6px;background:var(--blue);color:#fff;padding:8px 12px;border-radius:10px}
    .articles{display:grid;grid-template-columns:repeat(3,1fr);gap:16px;margin:32px 0}
    .article{background:#fff;border:1px solid var(--line);border-radius:16px;padding:16px;box-shadow:0 4px 14px rgba(2,6,23,.06)}
    .tag{display:inline-block;font-size:12px;background:#EEF2FF;color:var(--blue);padding:4px 8px;border-radius:999px;margin-bottom:8px}
    footer{margin-top:48px;background:#fff;border-top:1px solid var(--line)}
    .foot{display:grid;grid-template-columns:repeat(4,1fr);gap:16px;padding:24px 0}
    .foot h5{margin:0 0 8px;color:var(--ink)}
    .foot a{color:#111827;display:block;margin:6px 0}
    @media (max-width:900px){.jobs,.values,.articles{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <header>
    <div class="container nav">
      <div class="brand">GrowIndia Jobs</div>
      <div class="nav-right">
        <a class="btn-pill btn-blue" href="/register-candidate.html">Candidate</a>
        <a class="btn-pill btn-orange" href="/login.html?role=employer">Employer</a>
      </div>
    </div>
  </header>

  <main class="container">
    <section class="hero">
      <h1>Find work you’ll actually like.</h1>
      <div class="muted">Search by title, keyword, or location.</div>
      <form id="searchForm" class="search-wrap" role="search">
        <label class="search-field" aria-label="Keywords"><input id="q" placeholder="Job title, keywords, or company"/></label>
        <div class="divider" aria-hidden="true"></div>
        <label class="search-field" aria-label="Location"><input id="loc" placeholder="Dehradun, Uttarakhand"/></label>
        <button class="search-btn" type="submit">Find jobs</button>
      </form>
    </section>

    <section class="values">
      <div class="card"><strong>1-step apply</strong><br><span class="muted">Fast applications with your saved profile.</span></div>
      <div class="card"><strong>Zero fees</strong><br><span class="muted">No charges for candidates.</span></div>
      <div class="card"><strong>For employers</strong><br><span class="muted">Simple tools to post, review, and hire.</span></div>
    </section>

    <section style="margin:12px 0 8px;display:flex;align-items:center;justify-content:space-between">
      <h3 style="margin:0">Featured jobs</h3>
      <a href="/jobs.html">Browse all →</a>
    </section>
    <section id="featured" class="jobs" aria-live="polite"><div class="muted">Loading…</div></section>

    <section style="margin-top:28px;display:flex;align-items:center;justify-content:space-between">
      <h3 style="margin:0">Articles & Tutorials</h3>
      <a href="/admin-copy.html" class="muted">Edit →</a>
    </section>
    <section id="articles" class="articles" aria-live="polite"><div class="muted">Loading…</div></section>
  </main>

  <footer>
    <div class="container foot">
      <div><h5>About</h5><a href="#">Company</a><a href="#">Team</a><a href="#">Careers</a></div>
      <div><h5>Employer</h5><a href="#">—</a></div>
      <div><h5>Help</h5><a href="#">Support</a><a href="#">Guides</a></div>
      <div><h5>Legal</h5><a href="#">Terms</a><a href="#">Privacy</a></div>
    </div>
  </footer>

  <!-- Load order MUST be: UMD library -> config.js -> components.js -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.45.4/dist/umd/supabase.min.js"></script>
  <script src="/config.js"></script>
  <script src="/components.js?v=18"></script>
  <script>
    // Clean hash after email confirmation (so /#access_token… becomes /)
    (function cleanAuthHash(){
      if (location.hash && /access_token=|type=signup|type=recovery/.test(location.hash)) {
        history.replaceState(null,'','/');
      }
    })();

    // Clean known search params on home
    (function cleanHomeQS(){
      const p = location.pathname;
      if ((p === '/' || p === '/index.html') && location.search){
        const s = new URLSearchParams(location.search);
        const known = ['q','loc','type','page'];
        if ([...s.keys()].every(k=>known.includes(k))) history.replaceState(null,'','/');
      }
    })();

    // Search → /jobs.html
    document.getElementById('searchForm').addEventListener('submit', (e)=>{
      e.preventDefault();
      const q = encodeURIComponent(document.getElementById('q').value.trim());
      const loc = encodeURIComponent(document.getElementById('loc').value.trim());
      const type = 'all';
      window.location.href = `/jobs.html?q=${q}&loc=${loc}&type=${type}`;
    });

    // Featured + Articles
    (async function loadData(){
      try{
        const box = document.getElementById('featured');
        const { data, error } = await db.featuredJobs();
        if(error) throw error;
        if(!data?.length){ box.innerHTML = '<div class="muted">No published jobs yet.</div>'; return; }
        box.innerHTML = data.map(j=>(
          `<article class="job">
             <h4>${escapeHtml(j.title)}</h4>
             <div class="meta">${escapeHtml(j.company||'')} · ${escapeHtml(j.location||'')} · ${escapeHtml(j.employment_type||'')}</div>
             <div class="meta">Salary: ${(j.salary_min||j.salary_max)?\`₹\${j.salary_min||''}\${j.salary_min&&j.salary_max?'–':''}\${j.salary_max||''}\`:'—'}</div>
             <a class="btn-view" href="/job.html?id=${encodeURIComponent(j.id)}">View</a>
           </article>`
        )).join('');
      }catch(err){
        document.getElementById('featured').innerHTML = '<div class="muted">Couldn’t load jobs. Please try again later.</div>';
        ui.toast(err.message || 'Failed to load jobs','error');
      }

      try{
        const area = document.getElementById('articles');
        const { data } = await db.getSiteCopy('home_articles');
        const items = data?.content?.items || [];
        area.innerHTML = items.length ? items.map(a => (
          `<article class="article">
             <span class="tag">${escapeHtml(a.tag||'Tutorial')}</span>
             <h4 style="margin:0 0 6px"><a href="${a.url||'#'}" target="_blank" rel="noopener">${escapeHtml(a.title||'Article')}</a></h4>
             <a href="${a.url||'#'}" target="_blank" rel="noopener">Read →</a>
           </article>`
        )).join('') : '<div class="muted">No articles yet.</div>';
      }catch(err){
        document.getElementById('articles').innerHTML = '<div class="muted">Couldn’t load articles.</div>';
        ui.toast(err.message || 'Failed to load articles','error');
      }

      function escapeHtml(s=''){return s.replace(/[&<>"]+/g,c=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;"}[c]))}
    })();
  </script>
</body>
</html>
