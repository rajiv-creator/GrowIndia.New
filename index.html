<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>GrowIndia Jobs — Login</title>
  <link rel="stylesheet" href="/app.css" />
</head>
<body>
  <main class="container" style="max-width:760px;margin:48px auto;">
    <h1>Welcome back</h1>
    <p>Sign in to post jobs and manage your company.</p>

    <form id="loginform" class="card" style="padding:16px;">
      <label for="email" class="label">Email</label>
      <input id="email" type="email" class="input" placeholder="you@example.com" required />
      <button id="sendbtn" class="btn primary" type="submit" style="margin-top:12px;">Send magic link</button>
      <p id="msg" class="muted" style="margin-top:12px;"></p>
    </form>
  </main>

  <!-- JS (order matters!) -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="/config.js?v=5"></script>
  <script src="/components.js?v=5"></script>

  <script>
    (async () => {
      // If already signed in, bounce to post-auth
      const s = await GI.getSession();
      if (s) location.href = "/post-auth.html";

      const form = document.getElementById("loginform");
      const email = document.getElementById("email");
      const msg = document.getElementById("msg");
      form.addEventListener("submit", async (e) => {
        e.preventDefault();
        msg.textContent = "Sending magic link…";
        const { error } = await sbAuth.signInWithOtp({
          email: email.value,
          options: {
            emailRedirectTo: `${location.origin}/post-auth.html`,
          }
        });
        msg.textContent = error ? `Error: ${error.message}` : "Check your email for the sign-in link.";
      });
    })();
  </script>
</body>
</html>
